<!DOCTYPE html>
<html>
<head>
<title>Compare Code</title>
  <meta name="description" content="Road To Polymer code from 0.5 to 0.8 to 1.0" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- build:css styles/main.css -->
 <link rel="stylesheet" href="styles/main.css">
 <!-- endbuild-->

   <style>
     html, body {
       margin: 0;
       height: 100%;
       font-family: 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
     }
   </style>

  <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
  <link rel="import" href="bower_components/core-ajax/core-ajax.html">
  <link rel="import" href="bower_components/core-drawer-panel/core-drawer-panel.html">
  <link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
  <link rel="import" href="bower_components/core-icon/core-icon.html">
  <link rel="import" href="bower_components/core-icons/core-icons.html">
  <link rel="import" href="bower_components/core-media-query/core-media-query.html">
  <link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
  <link rel="import" href="bower_components/core-menu/core-menu.html">
  <link rel="import" href="bower_components/core-item/core-item.html">
  <link rel="import" href="bower_components/font-roboto/roboto.html">
  <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="bower_components/paper-input/paper-input.html">
  <link rel="import" href="bower_components/paper-radio-group/paper-radio-group.html">
  <link rel="import" href="bower_components/marked-element/marked-element.html">

</head>

<body unresolved fullbleed layout vertical>

  <polymer-element name="compare-code" attributes="" >
    https://api.github.com/repos/Polymer/core-toolbar/contents/core-toolbar.html?ref=master
    <template fit>
    <style>
      .page-toolbar {
        color: #fff;
        font-weight: 200;
        line-height: 30px;
        background-color: #7986cb;
      }
      .left {
        padding: 10px;
        background-color: #ddd;
      }

      .right {
        padding: 10px;
        background-color: #eee;
      }

      .code {
        font-size: 14px;
      }
      .error-message {
        color: red;
        font-weight: 400;
        font-size: 18px;
      }

    </style>

    <core-ajax id="get_code5_ajax"
      url="https://api.github.com/repos/Polymer/{{repoName}}/contents/{{repoName}}.html?ref=master",
      params='{"access_token": "d71d11c7725375ee53e649ef5cb4cf7ff805eb51"}'
      handleAs="json"
      loading="{{loading5}}"
      progress="{{progress5}}"
      response="{{code5}}"
      on-core-response="{{handleCode5Response}}"
      on-core-error="{{handleCode5ErrorResponse}}">
    </core-ajax>

    <core-ajax id="get_code8_ajax"
      url="https://api.github.com/repos/Polymer/{{repoName}}/contents/{{repoName}}.html?ref=0.8-preview",
      params='{"access_token": "d71d11c7725375ee53e649ef5cb4cf7ff805eb51"}'
      handleAs="json"
      loading="{{loading8}}"
      progress="{{progress8}}"
      response="{{code8}}"
      on-core-response="{{handleCode8Response}}"
      on-core-error="{{handleCode8ErrorResponse}}">
    </core-ajax>

    <core-header-panel main mode="seamed" fit>

      <!-- Main Toolbar -->
      <core-toolbar class="page-toolbar">
        Compare Code 0.5 to 0.8 -->
        <paper-input label="Name" value="{{repoName}}" on-blur="{{searchForRepo}}" on-keyup="{{searchForRepoKeyUp}}"></paper-input>
        <span style="font-size:0.8em"><-- input polymer element name then press enter key</span>
        <!-- <paper-icon-button icon="menu" core-drawer-toggle></paper-icon-button> -->
      </core-toolbar>

      <!-- Main Content -->
      <div class="page" fit>
        <div horizontal layout>
          <div flex class="left"><h3>Polymer 0.5 - {{repoName}} - <span class="error-message">{{errorMessage5}}</span></h3></div>
          <div flex class="right"><h3>Polymer 0.8 - {{repoName}} - <span class="error-message">{{errorMessage8}}</span></h3></div>
        </div>
        <div horizontal layout class="code">
          <div flex class="left" id="code5">
            <marked-element id="code5_marked"></marked-element>
          </div>

          <div flex class="right" id="code8">
            <marked-element id="code8_marked"></marked-element>
          </div>
        </div>
      </div>

    </core-header-panel>

  </template>

  <script>
    Polymer({

      repoName: "core-toolbar",
      errorMessage5: "",
      errorMessage8: "",
      tk: "d71d11c7725375ee53e649ef5cb4cf7ff805eb51",

      ready: function() {
        // this.repoName = "core-toolbar";
        console.log("compare-code ready");
        var elParam = this.getURLParameter('el');
        console.log("compare-code ready", elParam);
        if (elParam) {
          console.log("  elParam-code: ", elParam);
          this.repoName = elParam;
        }
  	    this.searchForRepo();
      },

      // function: getURLParameterx(name) {
      //   return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
      // },

      getURLParameter: function(name) {
         if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
            return decodeURIComponent(name[1]);
      },

      searchForRepo: function(e, detail, sender) {
          this.$.get_code5_ajax.abort();
          this.$.get_code5_ajax.go();
          this.$.get_code8_ajax.abort();
          this.$.get_code8_ajax.go();
      },
      searchForRepoKeyUp: function(e, detail, sender) {
        if (e.keyCode == 13) {
          this.$.get_code5_ajax.abort();
          this.$.get_code5_ajax.go();
          this.$.get_code8_ajax.abort();
          this.$.get_code8_ajax.go();
        }
      },

      handleCode5Response: function(event) {
        console.log("handleCode5Response", this.code5.name);
        var code5 = "``` " + atob(this.code5.content) + " ```" ;
        this.$.code5_marked.text = code5;
        this.errorMessage5 = "";
      },
      handleCode8Response: function(event) {
        console.log("handleCode8Response", this.code8.name);
        var code8 = "``` " + atob(this.code8.content) + " ```" ;
        this.$.code8_marked.text = code8;
        this.errorMessage8 = "";
      },
      handleCode5ErrorResponse: function(event) {
        var error = this.$.get_code5_ajax.error;
        this.errorMessage5 = "Can't find master code";
        this.$.code5_marked.text = " ";
        console.log("Error: " + error.statusCode + " - " + error.message);
      },
      handleCode8ErrorResponse: function(event) {
        var error = this.$.get_code8_ajax.error;
        this.errorMessage8 = "Can't find 0.8-preview code";
        this.$.code8_marked.text = " ";
        console.log("Error: " + error.statusCode + " - " + error.message);
      },
    });
  </script>

</polymer-element>

<compare-code></compare-code>

</body>
</html>
