<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/font-roboto/roboto.html" >
<!-- <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"> -->
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">

<dom-module id='repos-list'>

  <style is="custom-style">
    paper-radio-button.yellow {
      --paper-radio-button-unchecked-color: #5C6BC0;
      --paper-radio-button-unchecked-ink-color: #5C6BC0;
      --paper-radio-button-checked-color: #FFFF00;
      --paper-radio-button-checked-ink-color: #FFFF00;
    }
    paper-spinner {
      padding-left: 30px;
      padding-top: 15px;
    }
    paper-spinner.blue {
      --paper-spinner-layer-1-color: #4285f4;
      --paper-spinner-layer-2-color: #4285f4;
      --paper-spinner-layer-3-color: #4285f4;
      --paper-spinner-layer-4-color: #4285f4;
    }
    paper-spinner.yellow {
      --paper-spinner-layer-1-color: #FFFF00;
      --paper-spinner-layer-2-color: #FFFF00;
      --paper-spinner-layer-3-color: #FFFF00;
      --paper-spinner-layer-4-color: #FFFF00;
    }
    paper-spinner.pink {
      --paper-spinner-layer-1-color: var(--google-red-100);
      --paper-spinner-layer-2-color: var(--google-red-300);
      --paper-spinner-layer-3-color: var(--google-red-500);
      --paper-spinner-layer-4-color: var(--google-red-700);
    }
    paper-progress {
      width: 100%;
    }
    paper-progress.pink {
      --paper-progress-active-color: var(--google-red-300);
    }
    paper-progress.green {
      --paper-progress-active-color: var(--google-green-300);
    }
    paper-progress.yellow {
      --paper-progress-active-color: #FFFF00;
    }
  </style> <!-- TODO Move style tags here from <template> if needed CONVERTED WIP   FFF9C4  5a5a5a CCC79D A0A2B0-->
  <link rel="stylesheet" href="repos-list.css"> <!-- TODO Move line about <template>  CONVERTED WIP -->

  <template>

    <iron-media-query query="min-width: 800px" query-matches="{{mediumScreen}}" on-query-matches-changed="reposViewResized"></iron-media-query> <!-- TODO change on-xxx="{{handleClick}}" to on-xxx="handleClick"  CONVERTED WIP -->

    <iron-ajax id="get_repos_ajax"
      params='{"page": "1", "per_page": "10", "sort": "full_name","access_token": "16d359ef1b001628536988bc15168e4f7c267771" }'
      handle-as="json"
      last-response="{{repos}}"
      on-response="handleReposResponse"
      on-error="handleReposErrorResponse">
    </iron-ajax>
    <!-- TODO iron-ajax check url and params embed binding {{}} and params quotes  CONVERTED WIP -->

    <iron-ajax id="get_repos_page2_ajax"
      params='{"page": "2", "per_page": "10", "sort": "full_name","access_token": "16d359ef1b001628536988bc15168e4f7c267771" }'
      handle-as="json"
      last-response="{{repos2}}"
      on-response="handleRepos2Response">
    </iron-ajax>
    <!-- TODO iron-ajax check url and params embed binding {{}} and params quotes  CONVERTED WIP -->

    <!-- <iron-ajax id="get_branches_ajax"
      params='{"access_token": "d71d11c7725375ee53e649ef5cb4cf7ff805eb51"}'
      handle-as="json"
      last-response="{{branches}}"
      on-response="handleBranchesResponse">
    </iron-ajax> -->
    <!-- TODO iron-ajax check url and params embed binding {{}} and params quotes  CONVERTED WIP -->

    <iron-ajax id="get_releases_ajax"
      params='{"access_token": "d71d11c7725375ee53e649ef5cb4cf7ff805eb51"}'
      handle-as="json"
      last-response="{{releases}}"
      on-response="handleReleaseResponse"
      on-error="handleReleasesErrorResponse">
    </iron-ajax>
    <!-- TODO iron-ajax check url and params embed binding {{}} and params quotes  CONVERTED WIP -->

    <paper-header-panel id="paper_header_panel" class="fit">
      <div class="paper-header vertical layout">
        <div class="horizontal layout">
          <div class="report-title">Repositories Status</div>
          <paper-spinner id="loading_spinner" class="pink" active></paper-spinner>
          <div id="filter_container" class="filter flex">
            <span id="filter_title"></span>
            <paper-radio-group selected="All" class="yellow" id="radio_group_filter" on-paper-radio-group-changed="onRadioGroupFilterChange">
              <paper-radio-button name="All" label="All" class="yellow">All</paper-radio-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <paper-radio-button name="Yes" label="Yes" class="yellow">Yes</paper-radio-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <paper-radio-button name="no" label="no" class="yellow">no</paper-radio-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <paper-radio-button name="{{ironCore}}" label="{{ironCore}}" id="iron_radio_button" class="yellow" hidden$="{{hideRadioButton}}">{{ironCore}}</paper-radio-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <paper-radio-button name="Paper" label="Paper" id="paper_radio_button" class="yellow" hidden$="{{hideRadioButton}}">Paper</paper-radio-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <paper-radio-button name="Other" label="Other" id="other_radio_button" class="yellow" hidden$="{{hideRadioButton}}">Other</paper-radio-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <!-- <paper-radio-button name="YesCorePaper" label="Yes Core + Paper" on-click="{{filterRadioButtonRepos}}"></paper-radio-button> --> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
              <!-- <paper-radio-button name="NoCorePaper" label="No Core + Paper" on-click="{{filterRadioButtonRepos}}"></paper-radio-button> --> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
            </paper-radio-group>
          </div>
          <div id="search" class="search horizontal layout center">   <!-- class="horizontal layout"  // TODO cleanup class= if needed  CONVERTED WIP  -->
            <paper-icon-button icon="search" role="button" tabindex="0" aria-label="search" pressed="" active="" on-click="toggleSearch"></paper-icon-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
            <input is="iron-input" type="search" id="search_input" bind-value="{{bindValue}}" value="{{searchValue::input}}" on-keyup="filterSearchRepos" on-search=="filterSearchRepos" autocomplete="on" placeholder="search names, latest release, date" autofocus hidden> <!-- TODO change on-xxx="{{handleClick}}" to on-xxx="handleClick"  CONVERTED WIP -->
          </div>
        </div>

        <div id="org_container" class="orgs horizontal layout center">   <!-- class="horizontal layout center"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="select-label">Select </div>
          <paper-radio-group class="yellow-white" id="radio_group_org" on-paper-radio-group-changed="onOrgSelect"> <!-- TODO change on-xxx="{{handleClick}}" to on-xxx="handleClick"  CONVERTED WIP -->
            <paper-radio-button name="polymer" label="Polymer" class="yellow">Polymer</paper-radio-button>
            <paper-radio-button name="polymereelements" label="PolymerElements" class="yellow">PolymerElements</paper-radio-button>
            <paper-radio-button name="webcomponents" label="Google Web Components" class="yellow">Google Web Components</paper-radio-button>
          </paper-radio-group>
          <paper-icon-button id="refresh_button" icon="refresh" role="button" aria-label="refresh" on-click="refreshData"></paper-icon-button> <!-- TODO change on-click="{{handleClick}}" to on-click="handleClick"  CONVERTED WIP -->
        </div>

        <paper-progress class="pink" value="{{progressCounter}}" max="{{progressMax}}" hidden$="{{!hideList}}"></paper-progress>

        <div  class="titles horizontal layout">   <!-- class="horizontal layout"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="cntr">Cntr</div>
          <div class="flex">Name</div>   <!-- class="flexName</div>"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="flex-3"> Description</div>   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="center-text center flex">Latest Release</div>   <!-- class="flex "center""  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="center-text center flex" hidden$={{hideColumn5}}>0.8-<span>{{branchLookingFor}}</span></div>   <!-- class="flex "center""  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="flex" on-tap="sortDateReleased" hidden$={{hideColumn6}}>Date Released</div>   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  -->
        </div>
      </div>

      <div class="content">
        <div class="vertical layout">
          <template id="repos_template" is="dom-repeat" items="{{reposAllFiltered}}" hidden$="{{hideList}}"> <!-- sort="sortByDate" -->
            <a href="{{compareCodePrefix}}compare-code.html?el={{reposAllFiltered[0]}}&org={{organization}}" target="_blank" class="link">
              <div  class="row horizontal layout">   <!-- class="horizontal layout"  // TODO cleanup class= if needed  CONVERTED WIP  -->
                <div class="cntr">{{counter(index)}}. </div>
                <div class="flex repo-name" > <strong>{{item.0}}</strong></div>   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  -->
                <div class="flex-3 description">{{item.1}}</div>   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  -->
                <div class="center-text center flex">{{item.2}}</div>   <!-- class="flex "center""  // TODO cleanup class= if needed  CONVERTED WIP  -->
                <div class="center-text center flex" hidden$={{hideColumn5}}>{{item.3}}</div>   <!-- class="flex "center""  // TODO cleanup class= if needed  CONVERTED WIP  -->
                <div class="released flex" hidden$={{hideColumn6}}>{{item.4}}</div>   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  -->
              </div>
            </a>
          </template>
        </div>

        <div  class="counters horizontal layout">   <!-- class="horizontal layout"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="cntr">Counter</div>
          <div class="flex"></div>   <!-- class="flex</div>"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div class="flex" three>{{reposAllFiltered.length}}</div>   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div flex class="center-text flex center"></div>   <!-- class="flex "center""  // TODO cleanup class= if needed  CONVERTED WIP  -->
          <div flex class="center-text flex center" id="yes_counter" hidden>Yes: {{cntrYes}}</div>   <!-- class="flex "center""  // TODO cleanup class= if needed  CONVERTED WIP  -->
        </div>

        <h3 id="error_message" class="error"></h3>

        <hr>
        <footer>
          Report by Chuck Horton -- email chuckh @ hware.com<br>
          Select Github Orginaztion (Polymer, PolymerElments, ...) to load report.<br>
          Click on element to see compare code of Polymer 0.5 vs 1.0.<br>
          If you don't see results after filtering then scroll up.
        </footer>
      </div>
    </paper-header-panel>

  </template>

<script>
(function () {
  Polymer({
    is: 'repos-list', // CONVERTED WIP
    // this.reposAllFiltered = this.reposAll;

    properties: {
      reposAllFiltered: {
        type: Object,
        value: function() { return []; },
        notify: true
      },
      branchLookingFor: {
        type: String,
        value: "preview",
        notify: true,
        reflectToAttribute: true
      },
      searchValue: {
        type: String,
        value: "",
        notify: true
      },
      ironCore: {
        type: String,
        value: "Iron",
        notify: true
      },
      hideColumn5: {
        type: Boolean,
        value: true,
        notify: true,
        reflectToAttribute: true
      },
      hideColumn6: {
        type: Boolean,
        value: false,
        notify: true,
        reflectToAttribute: true
      },
      hideList: {
        type: Boolean,
        value: false,
        notify: true
      },
      hideRadioButton: {
        type: Boolean,
        value: false,
        notify: true
      },
      progressCounter: {
        type: Number,
        value: 0,
        notify: true,
        reflectToAttribute: true
      },
      progressMax: {
        type: Number,
        value: 20,
        notify: true,
        reflectToAttribute: true
      }
    },

    organization: "Polymer",
    // branchLookingFor: "preview", // will not find if you put 0.8 preview
    releaseLookingFor: "0.5.6",
    repos1Loaded: false,
    repos2Loaded: false,
    reposLoaded: false,
    reposAll: [],
    reposAll1: [],
    cntr: 0,
    cntrYes: 0,
    currentBranch: 0,
    currentBranchName: "",
    currentRelease: 0,
    currentReleaseName: "",
    currentError: "",
    tk: "16d359ef1b001628536988bc15168e4f7c267771",
    // searchValue: "",
    compareCodePrefix: "../",

    ready: function() {
      var hostName = window.location.hostname;
      if (hostName == "chuckh.github.io") {
        this.compareCodePrefix = "/road-to-polymer/";
      }
      // this.$.loading_spinner.active = false;
      this.$.loading_spinner.toggleAttribute("active",false);
      console.log("repos-list ready", hostName, this.compareCodePrefix);
    },

    handleReposResponse: function(event) {
      this.repos1Loaded = true;
      console.log("handleReposResponse", this.$.get_repos_ajax.loading);
      if (this.repos2Loaded) {
        this.reposLoaded = true;
        this.reposCombineAndFilter();
      }
    },
    handleReposErrorResponse: function(event) {
      var error = this.$.get_repos_ajax.error;
      console.log("Error: " + error.statusCode + " - " + error.message);
      this.currentError = error.statusCode;
      if (error.statusCode != 0) {
        this.$.error_message.innerHTML = "Over Github API Limit Try Againg in a hour.";
      }
      // "Over Github API Limit Try Againg in a hour."
    },

    handleRepos2Response: function() {
      this.repos2Loaded = true;
      if (this.repos1Loaded && !this.reposLoaded) {
        this.reposLoaded = true;
        this.reposCombineAndFilter();
      }
      console.log("handleRepos2Response",this.repos2Loaded);
    },

    reposCombineAndFilter: function (event) {
      // console.log("reposCombineSort",this.reposLoaded);
      this.progressMax = this.repos.length + this.repos2.length;
      var dataLen = this.repos.length;
      for (var i = 0; i < dataLen; i++) {
        if (this.repos[i].description) {
          if (this.repos[i].description.indexOf("DEPRECATED") < 0 && this.repos[i].description.indexOf("NOT FOR PRODUCTION USE") < 0) {
            this.reposAll.push([this.repos[i].name,this.repos[i].description]);
            this.reposAll1.push({ name: this.repos[i].name, description: this.repos[i].description });
          }
        } else {
          this.reposAll.push([this.repos[i].name,this.repos[i].description]);
          this.reposAll1.push({ name: this.repos[i].name, description: this.repos[i].description });
        }
      }
      if (this.repos2) {
        var dataLen2 = this.repos2.length;
        for (var i = 0; i < dataLen2; i++) {
          if (this.repos2[i].description) {
            if (this.repos2[i].description.indexOf("DEPRECATED") < 0 && this.repos[i].description.indexOf("NOT FOR PRODUCTION USE") < 0) {
              this.reposAll.push([this.repos2[i].name,this.repos2[i].description]);
              this.reposAll1.push({ name: this.repos2[i].name, description: this.repos[i].description });
            }
          } else {
            this.reposAll.push([this.repos2[i].name,this.repos2[i].description]);
            this.reposAll1.push({ name: this.repos2[i].name, description: this.repos[i].description });
          }
        }
      }
      // console.log("reposCombineAndFilter: ",this.reposAll);
      // this.reposAllFiltered = this.reposAll;
      // this.getBranches();
      this.getReleases();

      if (this.$.radio_group_org.selected == "polymer") { // Polymer
        this.reposPolymer = this.reposAll;
      } else if (this.$.radio_group_org.selected == "polymereelements") { // PolymerElements
        this.reposPolymerElements = this.reposAll;
      } else { // Google Web Components
        this.reposGoogleWebComponents = this.reposAll;
      }

    },

    // getBranches: function() {
    //   if (this.reposAll[this.currentBranch][0]) {
    //     var repo = this.reposAll[this.currentBranch][0];
    //     this.currentBranchName = repo;
    //     this.$.get_branches_ajax.url = "https://api.github.com/repos/" + this.organization + "/" + repo + "/branches";
    //     this.$.get_branches_ajax.generateRequest();
    //   }
    // },
    //
    // handleBranchesResponse: function(event) {
    //   var dataLen = this.branches.length;
    //   var branchFound = "no";
    //   var curBranch = "";
    //   for (var i = 0; i < dataLen; i++) {
    //     curBranch = this.branches[i].name.toLowerCase();
    //     if (curBranch.indexOf(this.branchLookingFor) > -1) {
    //       branchFound = "YES";
    //       this.cntrYes += 1;
    //     }
    //     this.reposAll[this.currentBranch][3] = branchFound;
    //   }
    //   this.currentBranch += 1;
    //   if (this.currentBranch < this.reposAll.length) {
    //     this.getBranches();
    //   }
    // },

    getReleases: function() {
      var repo = this.reposAll[this.currentRelease][0];
      this.currentReleaseName = repo;
      this.$.get_releases_ajax.url = "https://api.github.com/repos/" + this.organization + "/" + repo + "/releases/latest";

      // if (this.organization == "Polymer") {
      //   this.$.get_releases_ajax.url = "https://api.github.com/repos/" + this.organization + "/" + repo + "/releases/tags/" + this.releaseLookingFor;
      // } else if (this.organization ==  "PolymerElements") {
      //   this.$.get_releases_ajax.url = "https://api.github.com/repos/" + this.organization + "/" + repo + "/releases/latest";
      // } else {
      //   this.$.get_releases_ajax.url = "https://api.github.com/repos/" + this.organization + "/" + repo + "/releases/latest";
      // }
      // console.log("getReleases: ",this.$.get_releases_ajax.url, this.organization);
      this.$.get_releases_ajax.generateRequest();
      // this.$.get_releases_ajax.abort();
      // this.$.get_releases_ajax.go();
    },

    handleReleaseResponse: function(event) {
      if (this.organization == "Polymer" || this.organization == "PolymerElements" || this.organization == "GoogleWebComponents") {
        this.reposAll[this.currentRelease][2] = this.releases.tag_name;
        this.reposAll1[this.currentRelease].latest_release = this.releases.tag_name;

        if (this.releases.published_at) {
          var rdate = new Date(this.releases.published_at);
          this.reposAll[this.currentRelease][4] = rdate.toLocaleDateString() + " - " + rdate.toLocaleTimeString();
          this.reposAll1[this.currentRelease].released = rdate.toLocaleDateString() + " - " + rdate.toLocaleTimeString();
          this.reposAll1[this.currentRelease].released_datetime = this.releases.published_at;
        } else {
          this.reposAll[this.currentRelease][4] = "";
          this.reposAll1[this.currentRelease].released = "";
        }

      } else {
        this.reposAll[this.currentRelease][2] = this.releaseLookingFor.toString();
        // this.$.loading_spinner.active = false;
        this.$.loading_spinner.toggleAttribute("active",false);

        // this.hideList = false;
        // this.reposAll[this.currentRelease][3] = "";
      }
      this.currentRelease += 1;
      this.progressCounter = this.currentRelease;

      if (this.currentRelease < this.reposAll.length) {
        this.getReleases();
      } else {
        console.log("handleReleaseResponse: ","DONE", this.reposAll1);
        this.reposAllFiltered = this.reposAll;
        // this.$.loading_spinner.active = false;
        this.$.loading_spinner.toggleAttribute("active",false);
        this.hideList = false;
      }
    },
    handleReleasesErrorResponse: function(event) {
      //console.log("handleReleasesErrorResponse: ", this.currentRelease);
      this.reposAll[this.currentRelease][2] = "no";
      this.reposAll[this.currentRelease][4] = "";
      this.currentRelease += 1;
      this.progressCounter = this.currentRelease;
      if (this.currentRelease < this.reposAll.length) {
        this.getReleases();
      } else {
        this.hideList = false;
        this.$.loading_spinner.toggleAttribute("active",false);
        console.log("handleReleasesErrorResponse: ","DONE", this.reposAll1);
        this.reposAllFiltered = this.reposAll;

      }
    },

    filterSearchRepos: function() {
      this.filterRepos('search_input')
    },

    onRadioGroupFilterChange: function(e, detail, sender) {
      // var selectedLabel = this.$.radio_group_filter.selected;
      this.filterRepos(this.$.radio_group_filter.selected);
    },

    filterRepos: function(sender) {
      // console.log("filterRepos",detail, sender.label, sender.id);
      console.log("filterRepos", this.$.radio_group_filter.selected, sender);
      if (sender === "search_input") {
        this.$.radio_group_filter.selected = "All";
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          // console.log("search_input: ",this.searchValue + " -- ",d[0],d[2],d[4]);
          return (d[0].indexOf(this.searchValue) > -1 || d[2].indexOf(this.searchValue) > -1 || d[4].indexOf(this.searchValue) > -1);
        }.bind(this));
      } else if (sender === "All") {
        this.reposAllFiltered = this.reposAll;
      } else if (sender === "Iron") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return d[0].indexOf("iron") > -1;
        });
      } else if (sender === "Core") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return d[0].indexOf("core") > -1;
        });
      } else if (sender === "Paper") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return d[0].indexOf("paper") > -1;
        });
      } else if (sender === "Other") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return d[0].indexOf("paper") == -1 && d[0].indexOf("core") == -1 && d[0].indexOf("iron") == -1
        });
      } else if (sender === "No") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return d[2] == "no";
        });
      } else if (sender === "Yes Core + Paper") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return (d[0].indexOf("paper") > -1 || d[0].indexOf("core") > -1) && d[3] == "YES";
        });
      } else if (sender === "No Core + Paper") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          return (d[0].indexOf("paper") > -1 || d[0].indexOf("core") > -1) && d[3] == "no";
        });
      } else {
        // console.log("organization: ",this.organization.substr(0,7));
        // if (this.organization.substr(0,7) !== "Polymerx") {
        this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
          if (sender == "Yes") {
            return d[2] !== "no";
          } else {
            return d[2] === "no";
          }
        });
        // } else {
        //   this.reposAllFiltered = this.reposAll.filter(function(d, idx, array) {
        //     // return d[3] == "sender";
        //     if (sender == "Yes") {
        //       return d[3] !== "no";
        //     } else {
        //       return d[3] === "no";
        //     }
        //   });
        // }


      }
      // document.querySelector('#mainContainer').scroller.scrollTop = 0;
      // document.querySelector('#mainContainer').scroller.scrollIntoView();
    },

    reposViewResized: function(e, detail, sender) {
      var contentWidth = 0;
      if (this.$.paper_header_panel) {
        contentWidth = this.$.paper_header_panel.clientWidth;
      }
      //// TODO FIX this.$.filter_container.hidden = !this.mediumScreen;
      // console.log("reposViewResized: ", contentWidth, this.mediumScreen);
    },

    toggleSearch: function(e, detail, sender) {
      if (this.$.radio_group_filter.hidden) { // Hide search
        this.$.radio_group_filter.hidden = false;
        this.$.search_input.hidden = true;
        this.$.filter_title.hidden = false;
        this.searchValue = "";
        this.reposAllFiltered = this.reposAll;
      } else { // Show search
        this.$.radio_group_filter.selected = "All";
        this.$.radio_group_filter.hidden = true;
        this.$.search_input.hidden = false;
        this.$.filter_title.hidden = true;
      }
    },

    loadReport: function() {
      this.hideColumn5 = true;
      this.hideColumn6 = false;
      //this.$.radio_group_filter.selected = "All";
      if (this.$.radio_group_org.selected == "polymer") { // Polymer
        this.organization = "Polymer";
        this.$.iron_radio_button.label = "Core";
        this.ironCore = "Core";
        // this.hideColumn5 = true;
        // this.hideColumn6 = false;
        if (this.reposPolymer) {
          this.reposAllFiltered = this.reposPolymer;
          this.reposAll = this.reposPolymer;
        } else {
          this.loadReport2();
        }
      } else if (this.$.radio_group_org.selected == "polymereelements") { // PolymerElements
        this.organization = "PolymerElements";
        this.$.iron_radio_button.label = "Iron";
        this.ironCore = "Iron";
        // this.hideColumn5 = true;
        // this.hideColumn6 = false;
        if (this.reposPolymerElements) {
          this.reposAllFiltered = this.reposPolymerElements;
          this.reposAll = this.reposPolymerElements;
        } else {
          this.loadReport2();
        }
      } else { // Google Web Components
        this.organization = "GoogleWebComponents";
        if (this.reposGoogleWebComponents) {
          this.reposAllFiltered = this.reposGoogleWebComponents;
          this.reposAll = this.reposGoogleWebComponents;
        } else {
          this.loadReport2();
        }
      }
    },

    loadReport2: function() {
      console.log("loadReport2: ", this.$.radio_group_org.selected);
      //this.$.radio_group_filter.selected = "All";
      this.$.error_message.innerHTML = "";
      this.reposAll = [];
      this.reposAllFiltered = [];
      this.reposLoaded = false;
      this.repos1Loaded = false;
      this.repos2Loaded = false;
      this.hideList = true;
      this.$.loading_spinner.toggleAttribute("active",true);
      this.progressCounter = 0;

      this.cntr = 0;
      this.cntrYes = 0;
      this.currentBranch = 0;
      this.currentBranchName = "";
      this.currentRelease = 0;
      this.currentReleaseName = "";
      this.currentError = "";
      this.$.get_repos_ajax.url = "https://api.github.com/users/" + this.organization + "/repos";
      this.$.get_repos_ajax.generateRequest();
      this.$.get_repos_page2_ajax.url = "https://api.github.com/users/" + this.organization + "/repos";
      this.$.get_repos_page2_ajax.generateRequest();
    },

    onOrgSelect: function(e, detail, sender) {
      this.$.radio_group_filter.selected = "All";
      var selectedLabel = this.$.radio_group_org.selected;
      this.hideRadioButton = false;
      if (selectedLabel == "webcomponents") {
        this.hideRadioButton = true;
      }
      if (this.$.radio_group_org.selected) {
        // console.log("onOrgSelect: ", selectedLabel, this.hideRadioButton);
        if (selectedLabel == "polymer" && this.reposPolymer) { // Polymer
          this.reposAllFiltered = this.reposPolymer;
          this.reposAll = this.reposPolymer;
          this.$.iron_radio_button.label = "Core";
          this.ironCore = "Core";
        } else if (selectedLabel == "polymerelements" && this.reposPolymerElements) { // PolymerElements
          this.reposAllFiltered = this.reposPolymerElements;
          this.reposAll = this.reposPolymerElements;
          this.$.iron_radio_button.label = "Iron";
          this.ironCore = "Iron";
        } else if (selectedLabel == "webcomponents" && this.reposGoogleWebComponents) { // GoogleWebComponents
          this.reposAllFiltered = this.reposGoogleWebComponents;
          this.reposAll = this.reposGoogleWebComponents;
        } else {
          this.async(this.loadReport);
        }
      }
      // console.log("onOrgSelect: ", selectedLabel, this.hideRadioButton);
    },

    refreshData: function() {
      this.$.radio_group_filter.selected = "All";
      this.loadReport2();
    },

    counter: function(idx) {
      return idx + 1;
    },

    sortByDateAsc: false,
    sortByDate: function(a,b) {
      var aData = (new Date(a[4].substr(0,10))).getTime() || 0;
      var bData = (new Date(b[4].substr(0,10))).getTime() || 0;
      var returnVal = 0;  // a must be equal to b
      // console.log("sort: ",aData,' -- ',bData);
      if (aData > bData) {
        returnVal = ((this.sortByDateAsc) ? 1 : -1);
        console.log("sort: Greater", returnVal);
      }
      if (aData < bData) {
        returnVal =  ((this.sortByDateAsc) ? -1 : 1);
        console.log("sort: Smaller", returnVal);
      }
      // this.sortByDateAsc = !this.sortByDateAsc;
      return returnVal;
    },

    sortDateReleased: function() {
      console.log("sortDateReleased: ",this.sortByDateAsc);
      this.reposAllFiltered = this.reposPolymerElements;
      this.reposAllFiltered.sort(function(a,b) {
        //console.log(a[4],b[4]);
        var aData = (new Date(a[4].substr(0,10))).getTime() || 0;
        var bData = (new Date(b[4].substr(0,10))).getTime() || 0;
        var returnVal = 0;  // a must be equal to b
        // console.log("sort: ",aData,' -- ',bData);
        if (aData > bData) {
          console.log("sort: Greater");
          returnVal = ((this.sortByDateAsc) ? 1 : -1);
        }
        if (aData < bData) {
          console.log("sort: Smaller");
          returnVal =  ((this.sortByDateAsc) ? -1 : 1);
        }
        return returnVal;
      }.bind(this));
      this.sortByDateAsc = !this.sortByDateAsc;
      // this.$.repos_template.refresh();
      // this.reposAllFiltered.refresh();
      // this.reposAllFiltered = this.reposPolymerElements;
    },

  });
})();
</script>

</dom-module> <!-- CONVERTED -->


<!-- CONVERSION NOTES TODO:
Review code and look for:
- textContent binding from <div>First: {{first}}</div> TO First <span>{{first}}</span><br>
- polymer-element default attributes such as tabindex="0" move to hostAttributes: {  tabindex: 0}
- custom elements correct JSON quotes required, change from <my-element foo="{ 'title': 'Persuasion', 'author': 'Austen' }"> to </my-element> to <my-element foo="{ "title": "Persuasion", "author": "Austen" }"></my-element>
- custom elements attribute use dash-case not camelCase, change from  <my-element fooBar= to <my-element foo-bar
- Polymer( fix mixins use Behaviors after is: see https://www.polymer-project.org/0.9/docs/devguide/behaviors.html
- Check layout attributes replaced by layout classes <div layout horizontal center>` to `<div class="layout horizontal center">,
- Cleanup class=
- Convert core- to iron- or paper- replacement elements at PolymerElements
- Remove unresolved from <body> tag
- Cleanup iron-ajax params url if for embedded biddings {{}}=
- iron-ajax replace this.$.xxx_ajax.abort(); and this.$.xxx_ajax.go(); with this.$.xxx_ajax.generateRequest()
- fix indentation as need
- Cleanup Comments to reflect changes ,
- see https://www.polymer-project.org/0.9/docs/migration.html
-->
